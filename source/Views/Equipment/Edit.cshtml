@model MOD4.Web.ViewModel.EquipmentEditViewModel

<style>
    .col-md-10 {
        margin-top: 15px;
    }

    .card {
        box-shadow: 1px 2px 2px 2px #999;
    }

    .card-header {
        background-color: #3c7da6;
    }

    .card-body, .card-footer {
        background-color: #c3cadb;
    }

    .card-title {
        font-size: 20px;
        color: white;
        font-weight: 700;
    }

    #reamrk {
        padding: 0.375rem 0.75rem;
        line-height: 1.5;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        box-shadow: inset 0 0 0 transparent;
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }

    .unit {
        position: absolute;
        bottom: 0px;
        right: 10px;
        font-weight: 700;
    }

    label[name="underline"] {
        text-decoration: underline;
    }
</style>

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <!--<section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">編輯</li>
                    </ol>
                </div>
            </div>
        </div>-->
    <!-- /.container-fluid -->
    <!--</section>-->
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <!-- left column -->
                <div class="col-md-10">
                    <!-- jquery validation -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">機況編輯</h3>
                        </div>
                        <!-- /.card-header -->
                        <!-- form start -->
                        <form id="quickForm" action="Edit" method="post">
                            <div class="card-body">
                                <div class="row">
                                    <label class="col-form-label col-2" asp-for="StartTime"></label>
                                    <label class="col-form-label col-4" name="underline">@Model.StartTime</label>
                                    <label class="col-form-label col-2" asp-for="ToolId"></label>
                                    <label class="col-form-label col-4" name="underline">@Model.ToolId</label>
                                </div>
                                <div class="row">
                                </div>
                                <div class="row">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="Product"></label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" name="underline">@Model.Product</label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="ProductShortName"></label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" name="underline">@Model.ProductShortName</label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="ModelName"></label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" name="underline">@Model.ModelName</label>
                                    </div>
                                </div>
                                <div class="row" style="display: flex;">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="Code"></label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" name="underline">@Model.Code</label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="Codedesc"></label>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" name="underline">@Model.Codedesc</label>
                                    </div>
                                </div>
                                <div class="row" style="display: flex; margin-top: 10px; ">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="Comment"></label>
                                    </div>
                                    <div class="col-10">
                                        <textarea class="form-control pmEdit" asp-for="Comment" id="Comment" rows="2"></textarea>
                                    </div>
                                </div>
                                <div class="row" style="display: flex; margin-top: 10px;">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="ProcessId"></label>
                                        <span asp-validation-for="ProcessId" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <select class="form-control pmEdit" asp-for="ProcessId" asp-items="Model.ProcessOptionList">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="EqUnitId"></label>
                                        <span asp-validation-for="EqUnitId" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <select class="form-control pmEdit" asp-for="EqUnitId" asp-items="Model.EqUnitOptionList">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="EqUnitPartId" style="font-size:15px"></label>
                                        <span asp-validation-for="EqUnitPartId" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <select class="form-control pmEdit" asp-for="EqUnitPartId" asp-items="Model.EqUnitPartOptionList">
                                            <option></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row" style="display: flex;margin-top:10px;">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="DefectQty"></label>
                                        <span asp-validation-for="DefectQty" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <input class="form-control pmEdit" style="text-align:right" type="number" min="0" asp-for="DefectQty" />
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="DefectRate"></label>
                                        <span asp-validation-for="DefectRate" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <div>
                                            <input class="form-control pmEdit" type="text" min="0" max="100" maxlength="8" placeholder="ex:95.1234" asp-for="DefectRate" />
                                            <span class="unit">%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="display: flex;margin-top:10px;">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="Shift"></label>
                                        <span asp-validation-for="Shift" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <select class="form-control pmEdit" asp-for="Shift" asp-items="Model.ShiftOptionList">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="MntUser"></label>
                                        <span asp-validation-for="MntUser" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-2">
                                        <input class="form-control pmEdit" type="text" asp-for="MntUser" />
                                    </div>
                                </div>
                                <div class="row" style="margin-top:10px;">
                                    <div class="col-2">
                                        <label class="col-form-label" asp-for="MntMinutes"></label>
                                        <span asp-validation-for="MntMinutes" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                    </div>
                                    <div class="col-10">
                                        <textarea class="form-control pmEdit" asp-for="MntMinutes" id="Comment" rows="5" cols="75"></textarea>
                                    </div>
                                    <br />
                                </div>

                                @{
                                    if (Model.IsEngineerProcess == 1)
                                    {
                                        <hr style="border-width:3px;border-color:gray" />
                                        <div class="row" style="display: flex;margin-top:10px;">
                                            <div class="col-2">
                                                <label class="col-form-label" asp-for="Engineer"></label>
                                                <span asp-validation-for="Engineer" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                            </div>
                                            <div class="col-3">
                                                <input class="form-control" type="text" asp-for="Engineer" value="" />
                                            </div>
                                            <div class="col-2">
                                                <label class="col-form-label" asp-for="PriorityId"></label>
                                                <span asp-validation-for="PriorityId" style="font-size:10px;font-weight:700" class="text-danger"></span>
                                            </div>
                                            <div class="col-2">
                                                <select class="form-control" asp-for="PriorityId" asp-items="Model.PriorityOptionList">
                                                    <option></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top:10px;">
                                            <div class="col-2">
                                                <label class="col-form-label" asp-for="Memo"></label>
                                            </div>
                                            <div class="col-7">
                                                <textarea class="form-control" asp-for="Memo" rows="3" cols="75"></textarea>
                                            </div>
                                        </div>
                                    }
                                }
                                <input type="hidden" asp-for="sn" value="@Model.sn" />
                                <input type="hidden" asp-for="IsPMProcess" value="@Model.IsPMProcess" />
                                <input type="hidden" asp-for="IsEngineerProcess" value="@Model.IsEngineerProcess" />
                                <input type="hidden" asp-for="SearchVal" value="@Model.SearchVal" />
                            </div>
                            <!-- /.card-body -->
                            <div class="card-footer">
                                <input id="btnSave" type="button" class="btn btn-sm btn-info" value="儲存" />
                            </div>
                        </form>
                    </div>
                    <!-- /.card -->
                </div>
            </div>
            <!-- /.row -->
        </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
</div>


<script type="text/javascript">
    $('#btnSave').click(function (e) {
        e.preventDefault();
        if ($("#quickForm").valid()) {
            $.blockUI({
                message: '請稍等...',
                css: {
                    border: 'none',
                    padding: '5px',
                    backgroundColor: '#000',
                    '-webkit-border-radius': '10px',
                    '-moz-border-radius': '10px',
                    opacity: '.5',
                    color: '#fff',
                    fontSize: '25px',
                    fontFamily: '微軟正黑體',
                    fontWeight: 300,
                }
            });
            $.ajax({
                type: "POST",
                url: "/Equipment/Edit",
                dataType: 'json',
                data: $("#quickForm").serialize(),
                success: function (result) {
                    if (result != '') {
                        alert(result);
                        $.unblockUI();
                    }
                    else {
                        alert('更新成功');
                        location.href = "@Url.ActionLink("Index", "Equipment", new { searchVal = @Model.SearchVal })";
                    }
                }
            });
        }
        $.unblockUI();
    });

    if(@Model.IsEngineerProcess == 1) {
        $(".pmEdit").prop("disabled", true);
    }

    $("#ProcessId").change(function (e) {
        var eqUnitIdSelector = $("#EqUnitId");
        var eqUnitPartSelector = $("#EqUnitPartId");
        $.ajax({
            type: "GET",
            url: "/Equipment/GetSubOption?optionTypeId=2&mainId=" + e.currentTarget.value + "&subId=0",
            dataType: 'json',
            success: function (options) {
                eqUnitIdSelector.empty();
                eqUnitPartSelector.empty();
                $("<option></option>").appendTo(eqUnitIdSelector);
                $("<option></option>").appendTo(eqUnitPartSelector);
                var currVal = $("#ProcessId").val();
                for (var i = 0; i < options.length; i++) {
                    var option = options[i];
                    var opEl = $("<option></option>").attr("value", option.id).text(option.value);
                    if (currVal == option)
                        opEl.attr("selected", "selected");

                    opEl.appendTo(eqUnitIdSelector);
                }
            }
        });
    });

    $("#EqUnitId").change(function (e) {
        var eqUnitPartSelector = $("#EqUnitPartId");
        var processId = $("#ProcessId").val();
        $.ajax({
            type: "GET",
            url: "/Equipment/GetSubOption?optionTypeId=3&mainId=" + processId + "&subId=" + e.currentTarget.value,
            dataType: 'json',
            success: function (options) {
                eqUnitPartSelector.empty();
                $("<option></option>").appendTo(eqUnitPartSelector);

                var currVal = $("#EqUnitId").val();
                for (var i = 0; i < options.length; i++) {
                    var option = options[i];
                    var opEl = $("<option></option>").attr("value", option.id).text(option.value);
                    if (currVal == option)
                        opEl.attr("selected", "selected");

                    opEl.appendTo(eqUnitPartSelector);
                }
            }
        });
    });

    $("#EquipmentId").change(function (e) {
        var modelCatgSelector = $("#ModelId");
        $.ajax({
            type: "GET",
            url: "/Equipment/ModelNameOption?id=" + e.currentTarget.value,
            dataType: 'json',
            success: function (options) {
                modelCatgSelector.empty();
                var currVal = $("#EquipmentId").val();
                for (var i = 0; i < options.length; i++) {
                    var option = options[i];
                    var opEl = $("<option></option>").attr("value", option.id).text(option.value);
                    if (currVal == option) opEl.attr("selected", "selected");
                    opEl.appendTo(modelCatgSelector);
                }
            }
        });
    });

</script>